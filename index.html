<!DOCTYPE html>
<html>
<head>
    <title>Google Docs</title>
    <link rel="shortcut icon" href="https://ssl.gstatic.com/docs/documents/images/kix-favicon-2023q4.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        html, body {
            font-family: sans-serif;
            margin: 0;
            --border-width: 2.5px;
            --base-color: hsl(230, 40%, 18%);
            --accent-color: hsl(from var(--base-color) h s calc(l + 30));
        }
        h1 {
            text-align: center;
        }
        #frame, #staticFrame, #contentFallback {
            border: none;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
        }
        .flat-button {
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;

            text-align: center;
            background-color: transparent;
            color: white;
            padding: -2px;
            border-radius: 100%;
            border-color: white;
            border-style: solid;
            border-width: var(--border-width);
            cursor: pointer;
            font-size: 100%;
            height: 100%;
            aspect-ratio: 1;
            transition-duration: 1s;
        }
        .Navbar {
            display: flex;
            gap: 10px;
            align-items: center;
            width: calc(100%-10px);
            height: 40px;
            padding: 5px;
            background-color: var(--base-color);
            border-width: 0;
            border-bottom-width: var(--border-width);
            border-color: white;
            border-style: solid;
            z-index: 9999;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 250ms ease-in-out;
        }
        .flat-button #input {
            align-content: center;
            align-self: center;
            pointer-events: all;
            box-sizing: border-box;
        }
        #input {
            height: 100%;
            width: 100%;
            background-color: var(--accent-color);
            border-style: solid;
            border-color: white;
            color: white;
            border-width: var(--border-width);
            font-size: 100%;
        }
        #refresh {
            rotate: 0deg;
            transition: rotate 700ms ease-out;
        }
        #settingsPanel {
            position: absolute;
            padding-inline: 20px;
            box-shadow: 5px 5px 37px -15px rgba(0, 0, 0, 0.8);
            background-color: var(--base-color);
            border: solid white var(--border-width);
            border-radius: 10px;
            color: white;
            width: 60%;
            height: 80%;
            opacity: 0;
            transition: all 500ms ease-in-out;
        }
        #settingsPanel:popover-open {
            opacity: 0.5;
        }
        #settingsPanel h2 {
            color: white;
            font-size: 2em;
        }
        #settingsPanel h2::after {
            content: "";
            display: block;
            border-bottom: solid white var(--border-width);
            padding-top: 5px;
            width: 100%;
        }
        #tabs {
            --scrollbar-size: 4px;
            height: 100%;
            color: white;
            display: flex;
            white-space: nowrap;
            overflow: auto;
            gap: 10px;
        }
        #tabs::-webkit-scrollbar {
            background-color: transparent;
            height: var(--scrollbar-size);
        }
        #tabs::-webkit-scrollbar-thumb {
            background: white;
            padding: 0.5px;
            border-radius: var(--scrollbar-size);
        }
    </style>
</head>
<script>
const ParentWindow = true

function openPopup() {
    let w = open("")

    w.document.head.innerHTML += document.head.innerHTML
    w.document.body.innerHTML += document.getElementById("Content").innerHTML

    const definitions = w.document.createElement("script")
    definitions.textContent = document.getElementById("definitions").innerHTML
    w.document.head.appendChild(definitions)
    w.focus()
    close()
}

document.addEventListener("click",openPopup,{once:true});

const messages = [
    "Are you supposed to be on this?",
    "Spontaneous migration in 3... 2... 1...",
    "You're being evil again aren't you",
    "Easter eggs are just your imagination",
    "I don't have any games on my phone",
    "You're harming the learning environment",
    "If there's too little messages here, that's too bad"
]
const message =  messages[Math.floor(Math.random() * messages.length)]

if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
} else {
    init();
}

function init() {
    openPopup()
    document.getElementById('info').hidden=false; 
    document.getElementById('message').innerHTML+=message;
}

</script>
<script id="definitions" type="text/javascript">
if (window.opener) {

let frame;
let staticFrame;
let contentFallback;
let refresh;
let input;
let isStaticContent = false;
let bustCache = false;
let originalURL = "";
let cacheBustedURL = "";
let staticSrc = "";

let unloadCallback = false;

if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
} else {
    init();
}

function init() {
    window.opener.close()
    frame = document.getElementById("frame");
    staticFrame = document.getElementById("staticFrame");
    contentFallback = document.getElementById("contentFallback")
    refresh = document.getElementById("refresh");
    input = document.getElementById("input");

    // Ensure the newest version of the site is shown
    RefreshContent();

    frame.contentWindow.addEventListener("unload", function(){
        if (unloadCallback) {
            console.log("unload");
            showStopLoad()
        } else {
            unloadCallback = true;
        }
    });
    staticFrame.contentWindow.addEventListener("unload", function(){
        if (unloadCallback) {
            showDynamicContent()
            frame.src = staticFrame.src
            console.log("unload static");
        }
    });
}

function showRefresh() {
    refresh.hidden = false;
    stopLoad.hidden = true;
}

function showStopLoad() {
    refresh.hidden = true;
    stopLoad.hidden = false;
}

function showDynamicContent() {
    staticFrame.hidden = true;
    frame.hidden = false;
    contentFallback.hidden = true;
    isStaticContent = false;
}

function showStaticContent() {
    staticFrame.hidden = false;
    frame.hidden = true;
    contentFallback.hidden = true;
    isStaticContent = true;
}

function showFallbackContent() {
    staticFrame.hidden = true;
    frame.hidden = true;
    contentFallback.hidden = false;
    isStaticContent = true;
}

function isValidUrl(url) {
  try {
    new URL(url);
    return true;
  } catch (error) {
    return false;
  }
}

function LoadContent() {
    showDynamicContent()
    // remove previous listener on the iframe element if present
    if (typeof loadEventListener !== "undefined" && loadEventListener) {
        frame.removeEventListener("load", ContentLoaded);
    }
    frame.addEventListener("load", ContentLoaded);

    if (bustCache) {
        bustCache = false;
        originalURL = input.value;
        const urlObj = new URL(originalURL);
        urlObj.searchParams.set(`cachebust-${Date.now()}`, Math.random().toString(36));
        cacheBustedURL = urlObj.toString();
        frame.src = cacheBustedURL;
    } else {
        frame.src = input.value;
    }
    showStopLoad();
}

function StopLoadContent() {
    // Primary attempt: instruct the iframe's window to stop loading.
    try {
        if (frame && frame.contentWindow) {
            frame.contentWindow.stop();
            showRefresh();
            return;
        }
    } catch (e) {
        // Cross-origin access may throw when trying to call stop()
        console.warn('frame.contentWindow.stop() threw:', e);
    }

    // Fallback for same-origin: capture current DOM into the staticFrame using srcdoc
    try {
        // Accessing document will throw for cross-origin
        staticSrc = frame.src;
        const docHtml = frame.contentWindow.document.documentElement.outerHTML;
        staticFrame.srcdoc = docHtml;
        showStaticContent();
        frame.src = 'about:blank';
        showRefresh();
        return;
    } catch (e) {
        console.warn('Same-origin snapshot failed (probably cross-origin):', e);
    }

    // Last-resort visual fallback: show a frozen overlay
    try {
        frame.src = 'about:blank';
        showFallbackContent()
        showRefresh();
    } catch (e) {
        console.warn('Cross-origin fallback failed:', e);
    }
}

function RefreshContent() {
    console.log("refresh")
    bustCache = true;

    if (isStaticContent) {
        frame.src = staticSrc
    } else if (frame.src !== cacheBustedURL) {
        input.value = frame.src;
    }
    LoadContent()
}

function ContentLoaded() {
    console.log("Loaded");
    showRefresh();
    const rotation = Number(refresh.style.rotate.replace("deg","") || 0);

    requestAnimationFrame(() => {
        refresh.style.rotate = `${rotation + 360}deg`;
    });
    
    if ((!isStaticContent) && (frame.src !== cacheBustedURL)) {
        input.value = frame.src;
    }

    try {
        frame.contentWindow.focus();
    } catch (e) {}
}

function UrlInputKeyDown(Key) {
    if (Key.code === "Enter") {
        //Validate URL
        if ((!isValidUrl(input.value)) && (input.value.indexOf(".") != -1)) {
            input.value = "http://"+input.value;
        }
        if (input.value.indexOf(".") == 0 || input.value.length==0) {
            input.value = "https://standofevil1555.sevalla.page/";
        }
        LoadContent();
    }
}

}
</script>
<body>
    <div id="Content" hidden="true">
        <div class="Navbar">
            <button class="flat-button" id="refresh" onclick="RefreshContent()">&#x21bb;</button>
            <button class="flat-button" id="stopLoad" onclick="StopLoadContent()" hidden="true">x</button>
            <Input type="url" id="input" onkeydown="UrlInputKeyDown(event)" value="https://standofevil1555.sevalla.page/">
            <!--<div id="tabs">
                <div>tab 1eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</div>
                <div>tab 1eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</div>
                <div>tab 1eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</div>
                <div>tab 1eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</div>
                <div>tab 1eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</div>
                <div>tab 1eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</div>
                <div>tab 1eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</div>
                <div>tab 1eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</div>
                <div>tab 1eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</div>
                <div>tab 2</div>
                <div>tab 2</div>
                <div>tab 2</div>
            </div>-->
            <button class="flat-button" id="Settings" popovertarget="settingsPanel" hidden="true">
                <!-- Created with Inkscape (http://www.inkscape.org/) -->
                <svg
                    viewBox="0 0 6.9209804 6.9209804"
                    version="1.1">
                    <defs
                        id="defs1" />
                    <g
                        transform="matrix(1.4406644,0,0,1.4406644,3.4604902,3.4604902)"
                        id="g38"
                        style="stroke-width:0.999957;stroke-dasharray:none">
                        <path
                        style="fill:none;stroke:#ffffff;stroke-width:0.999957;stroke-dasharray:none;stroke-opacity:1"
                        d="m 1.36191,-0.36754 0.02168,-0.00319 0.51842,0.19779 V 0.17294 L 1.38359,0.37073 1.36191,0.36754 0.99926,0.99568 1.01286,1.01286 1.10077,1.56072 0.80124,1.73366 0.37073,1.38359 0.36265,1.36322 h -0.7253 L -0.37073,1.38359 -0.80124,1.73366 -1.10077,1.56072 -1.01286,1.01286 -0.99926,0.99568 -1.36191,0.36754 -1.38359,0.37073 -1.90201,0.17294 v -0.34588 l 0.51842,-0.19779 0.02168,0.00319 0.36265,-0.62813999 -0.0136,-0.01718 -0.08791,-0.54786 0.29953,-0.17294 0.43051,0.35007 0.00808,0.02037 h 0.7253 l 0.00808,-0.02037 0.43051,-0.35007 0.29953,0.17294 -0.08791,0.54786 -0.0136,0.01718 z"
                        id="path37" />
                        <circle
                        style="fill:none;stroke:#ffffff;stroke-width:0.751917;stroke-dasharray:none;stroke-opacity:1"
                        id="path38"
                        cx="8.4411137e-16"
                        cy="8.4411137e-16"
                        r="1.2080435" />
                    </g>
                </svg>
            </button>
        </div>
        <iframe src="https://standofevil1555.sevalla.page/" id="frame"></iframe>
        <iframe id="staticFrame" hidden="true"></iframe>
        <div id="contentFallback" hidden="true">
            <h1>
                Access denied to embedded page content
                <br>
                :(
            </h1>
        </div>
        <div id="settingsPanel" popover="auto">
            <h2>Settings</h2>
        </div>
    </div>
    <h1 id="message" style="color: red;" onload="document.getElementById('info').hidden=false; document.getElementById('message').innerHTML+=message;">
        <script>
            
        </script>
        <noscript>You don't have javascript enabled lol</noscript>
    </h1>
    <h1 id="info" hidden="true">
        Click anywhere to continue
        <br>
        u4
    </h1>
</body>
</html>